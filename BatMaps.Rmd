---
title: "BatMaps"
author: "Darius Arasteh"
date: "2/28/2026"
output: html_document
---
## Load the libraries
```{r message=FALSE, warning=FALSE}
library(tidyverse)
library(janitor)
```

## Install and load the `ggmap` and `leaflet` packages  
```{r message=FALSE, warning=FALSE}
#install.packages("ggmap")
library(ggmap)
#install.packages("leaflet")
library(leaflet)
```

## Register for a Stamen API Key
Because some of these maps are proprietary, you will need an API key to use them. We are going to use Stamen maps which requires registration, but no payment.   

Start by making an account with [Stadia Maps](https://client.stadiamaps.com/signup/). You need to add a "property" which is just a name for your project. Once you have an account, you can get an API key. Use the following code to register your key.  
```{r}
register_stadiamaps("98ed9db5-d37d-4aee-af77-e9e3f4d0f242", write = FALSE)
```


cleaning data:
```{r}
capture <- read.csv("Data/NWTMyotisCaptureRecords_ReimerBarclay2023.csv",
  na.strings = c("", " ")
)

library(shiny)
library(shinydashboard)
library(tidyverse)

# -------- LOAD CAPTURE DATA --------
capture_raw <- read.csv(
  "Data/NWTMyotisCaptureRecords_ReimerBarclay2023.csv",
  na.strings = c("", " ")
)


# Convert to proper types
capture_raw$Region <- as.factor(capture_raw$Region)
capture_raw$Sex <- as.factor(capture_raw$Sex)
capture_raw$Ageclass <- as.factor(capture_raw$Ageclass)
capture_raw$Reproductivestatus <- as.factor(capture_raw$Reproductivestatus)

# Remove NA in variables of interest
capture_clean <- capture_raw %>%
  filter(
    !is.na(Region),
    !is.na(Sex),
    !is.na(Ageclass),
    !is.na(Reproductivestatus),
    !is.na(Forearmlengthmm),
    !is.na(Earlengthmm)
  )

# -------- REMOVE EAR LENGTH OUTLIERS (IQR method) --------
Q3 <- quantile(capture_clean$Earlengthmm, 0.75)
IQR_val <- IQR(capture_clean$Earlengthmm)

upper_bound <- Q3 + 1.5 * IQR_val

capture <- capture_clean %>%
  filter(Earlengthmm <= upper_bound)

# Convert categorical variables
capture$Region <- as.factor(capture$Region)
capture$Sex <- as.factor(capture$Sex)
capture$Ageclass <- as.factor(capture$Ageclass)
capture$Reproductivestatus <- as.factor(capture$Reproductivestatus)


```


getting min and max:
```{r}
capture %>% 
  select(Latitude, Longitude) %>% 
  summary()
```
setting bounding box:
```{r}
lat <- c(59.7, 60.96)
long <-c(-117.4, -112.2)
batbox <- make_bbox(long, lat, f=0.03)
```

```{r}
map1 <- get_stadiamap(batbox, maptype="stamen_terrain", zoom=7)
```
```{r}
ggmap(map1) +
  geom_point(data=capture, aes(Longitude, Latitude), size=0.75, color="darkred", alpha=.8)+
  labs(x="Longitude", y="Latitude", title="Bat Capture Data")
```


